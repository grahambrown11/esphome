{"version":3,"file":"c.db76c3bd.js","sources":["../../../../src/components/process-dialog.ts"],"sourcesContent":["import { LitElement, html, css } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport \"@material/mwc-dialog\";\nimport \"@material/mwc-button\";\nimport \"../components/remote-process\";\nimport { fireEvent } from \"../util/fire-event\";\nimport { esphomeDialogStyles } from \"../styles\";\nimport { textDownload } from \"../util/file-download\";\nimport { basename } from \"../util/basename\";\nimport { mdiCloseCircleOutline, mdiCloseOctagonOutline, mdiMonitorArrowDown } from \"@mdi/js\";\n\n@customElement(\"esphome-process-dialog\")\nexport class ESPHomeProcessDialog extends LitElement {\n  @property() public heading!: string;\n  @property() public spawnParams?: Record<string, any>;\n  @property() public type!: string;\n\n  @property({ type: Boolean, attribute: \"always-show-close\" })\n  public alwaysShowClose = false;\n\n  @state() private _result?: number;\n\n  protected render() {\n    return html`\n      <mwc-dialog\n        open\n        heading=${this.heading}\n        scrimClickAction\n        @closed=${this._handleClose}\n      >\n        <esphome-remote-process\n          .type=${this.type}\n          .spawnParams=${this.spawnParams}\n          @process-done=${this._handleProcessDone}\n        ></esphome-remote-process>\n\n        <mwc-button\n          slot=\"secondaryAction\"\n          label=\"Download Logs\"\n          @click=${this._downloadLogs}\n        >\n          <esphome-svg-icon\n            slot=\"icon\"\n            .path=${mdiMonitorArrowDown}\n          ></esphome-svg-icon>\n        </mwc-button>\n\n        <slot name=\"secondaryAction\" slot=\"secondaryAction\"></slot>\n\n        <mwc-button\n          slot=\"primaryAction\"\n          dialogAction=\"close\"\n          .label=${this._result === undefined && !this.alwaysShowClose\n            ? \"Stop\"\n            : \"Close\"}\n        >\n          <esphome-svg-icon\n            slot=\"icon\"\n            .path=${this._result === undefined &&  !this.alwaysShowClose ? mdiCloseOctagonOutline : mdiCloseCircleOutline}\n          ></esphome-svg-icon>\n        </mwc-button>\n      </mwc-dialog>\n    `;\n  }\n\n  private _handleProcessDone(ev: { detail: number }) {\n    this._result = ev.detail;\n  }\n\n  private _handleClose() {\n    fireEvent(this, \"closed\");\n  }\n\n  private _downloadLogs() {\n    let filename = \"logs\";\n    if (this.spawnParams?.configuration) {\n      // Append filename without extension\n      filename += `_${basename(this.spawnParams.configuration)}`;\n    }\n    filename += `_${this.type}.txt`;\n\n    textDownload(\n      this.shadowRoot!.querySelector(\"esphome-remote-process\")!.logs(),\n      filename\n    );\n  }\n\n  static styles = [\n    esphomeDialogStyles,\n    css`\n      :host {\n        --height-header-footer-padding: 152px;\n      }\n      mwc-dialog {\n        --mdc-dialog-min-width: 95vw;\n        --mdc-dialog-max-width: 95vw;\n      }\n\n      esphome-remote-process {\n        height: calc(90vh - var(--height-header-footer-padding));\n      }\n\n      @media only screen and (max-width: 450px) {\n        esphome-remote-process {\n          height: calc(\n            90vh - var(--height-header-footer-padding) -\n              env(safe-area-inset-bottom)\n          );\n          margin-left: -24px;\n          margin-right: -24px;\n        }\n      }\n    `,\n  ];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"esphome-process-dialog\": ESPHomeProcessDialog;\n  }\n}\n"],"names":["ESPHomeProcessDialog","LitElement","constructor","this","alwaysShowClose","render","html","heading","_handleClose","type","spawnParams","_handleProcessDone","_downloadLogs","mdiMonitorArrowDown","undefined","_result","mdiCloseCircleOutline","mdiCloseOctagonOutline","ev","detail","fireEvent","filename","_a","configuration","basename","textDownload","shadowRoot","querySelector","logs","styles","esphomeDialogStyles","css","__decorate","property","prototype","Boolean","attribute","state","customElement"],"mappings":"uIAYO,IAAMA,EAAN,cAAmCC,EAAnCC,kCAMEC,KAAeC,iBAAG,CAgG1B,CA5FWC,SACR,OAAOC,CAAI;;;kBAGGH,KAAKI;;kBAELJ,KAAKK;;;kBAGLL,KAAKM;yBACEN,KAAKO;0BACJP,KAAKQ;;;;;;mBAMZR,KAAKS;;;;oBAIJC;;;;;;;;;wBASgBC,IAAjBX,KAAKY,SAA0BZ,KAAKC,gBAEzC,QADA;;;;yBAKuBU,IAAjBX,KAAKY,SAA2BZ,KAAKC,gBAA2CY,EAAzBC;;;;KAKxE,CAEON,mBAAmBO,GACzBf,KAAKY,QAAUG,EAAGC,MACnB,CAEOX,eACNY,EAAUjB,KAAM,SACjB,CAEOS,sBACN,IAAIS,EAAW,QACK,UAAhBlB,KAAKO,mBAAW,IAAAY,OAAA,EAAAA,EAAEC,iBAEpBF,GAAY,IAAIG,EAASrB,KAAKO,YAAYa,kBAE5CF,GAAY,IAAIlB,KAAKM,WAErBgB,EACEtB,KAAKuB,WAAYC,cAAc,0BAA2BC,OAC1DP,EAEH,GAEMrB,EAAA6B,OAAS,CACdC,EACAC,CAAG;;;;;;;;;;;;;;;;;;;;;;;OA5EcC,EAAA,CAAlBC,KAAmCjC,EAAAkC,UAAA,eAAA,GACjBF,EAAA,CAAlBC,KAAoDjC,EAAAkC,UAAA,mBAAA,GAClCF,EAAA,CAAlBC,KAAgCjC,EAAAkC,UAAA,YAAA,GAG1BF,EAAA,CADNC,EAAS,CAAExB,KAAM0B,QAASC,UAAW,uBACPpC,EAAAkC,UAAA,uBAAA,GAEdF,EAAA,CAAhBK,KAAiCrC,EAAAkC,UAAA,eAAA,GARvBlC,EAAoBgC,EAAA,CADhCM,EAAc,2BACFtC"}
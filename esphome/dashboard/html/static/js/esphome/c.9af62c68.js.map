{"version":3,"file":"c.9af62c68.js","sources":["../../../../src/compile/compile-dialog.ts"],"sourcesContent":["import { LitElement, html, css } from \"lit\";\nimport { customElement, property, state } from \"lit/decorators.js\";\nimport \"@material/mwc-button\";\nimport \"../components/remote-process\";\nimport \"../components/process-dialog\";\nimport \"../components/esphome-svg-icon\";\nimport { openCompileDialog } from \".\";\nimport { getDownloadUrl } from \"../api/configuration\";\nimport { esphomeDialogStyles } from \"../styles\";\nimport { mdiFileDownloadOutline, mdiRefresh } from \"@mdi/js\";\n\n@customElement(\"esphome-compile-dialog\")\nclass ESPHomeCompileDialog extends LitElement {\n  @property() public configuration!: string;\n  @property() public downloadFactoryFirmware = true;\n  @property() public buildOnly? = false;\n  @state() private _result?: number;\n\n  protected render() {\n    return html`\n      <esphome-process-dialog\n        .heading=${`${this.buildOnly ? \"Build\" : \"Download\"} ${this.configuration}`}\n        .type=${\"compile\"}\n        .spawnParams=${{ configuration: this.configuration }}\n        @closed=${this._handleClose}\n        @process-done=${this._handleProcessDone}\n      >\n        ${this._result === undefined\n          ? \"\"\n          : this._result === 0\n          ? html`\n              <a\n                slot=\"secondaryAction\"\n                href=\"${getDownloadUrl(\n                  this.configuration,\n                  this.downloadFactoryFirmware\n                )}\"\n                rel=\"external\"\n              >\n                <mwc-button label=\"Download\">\n                <esphome-svg-icon\n                  slot=\"icon\"\n                  .path=${mdiFileDownloadOutline}\n                ></esphome-svg-icon>\n                </mwc-button>\n              </a>\n            `\n          : html`\n              <mwc-button\n                slot=\"secondaryAction\"\n                dialogAction=\"close\"\n                label=\"Retry\"\n                @click=${this._handleRetry}\n              >\n                <esphome-svg-icon\n                  slot=\"icon\"\n                  .path=${mdiRefresh}\n                ></esphome-svg-icon>\n              </mwc-button>\n            `}\n      </esphome-process-dialog>\n    `;\n  }\n\n  private _handleProcessDone(ev: { detail: number }) {\n    this._result = ev.detail;\n\n    if (ev.detail !== 0) {\n      return;\n    }\n\n    const link = document.createElement(\"a\");\n    link.download = this.configuration + \".bin\";\n    link.rel = \"external\";\n    link.href = getDownloadUrl(\n      this.configuration,\n      this.downloadFactoryFirmware\n    );\n    document.body.appendChild(link);\n    if (!this.buildOnly) {\n      link.click();\n      link.remove();\n    }\n  }\n\n  private _handleRetry() {\n    openCompileDialog(this.configuration, this.downloadFactoryFirmware);\n  }\n\n  private _handleClose() {\n    this.parentNode!.removeChild(this);\n  }\n\n  static styles = [\n    esphomeDialogStyles,\n    css`\n      a {\n        text-decoration: none;\n      }\n    `,\n  ];\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    \"esphome-compile-dialog\": ESPHomeCompileDialog;\n  }\n}\n"],"names":["ESPHomeCompileDialog","LitElement","constructor","this","downloadFactoryFirmware","buildOnly","render","html","configuration","_handleClose","_handleProcessDone","undefined","_result","getDownloadUrl","mdiFileDownloadOutline","_handleRetry","mdiRefresh","ev","detail","link","document","createElement","download","rel","href","body","appendChild","click","remove","openCompileDialog","parentNode","removeChild","styles","esphomeDialogStyles","css","__decorate","property","prototype","state","customElement"],"mappings":"uKAYA,IAAMA,EAAN,cAAmCC,EAAnCC,kCAEqBC,KAAuBC,yBAAG,EAC1BD,KAASE,WAAI,CAsFjC,CAnFWC,SACR,OAAOC,CAAI;;mBAEI,GAAGJ,KAAKE,UAAY,QAAU,cAAcF,KAAKK;gBACpD;uBACO,CAAEA,cAAeL,KAAKK;kBAC3BL,KAAKM;wBACCN,KAAKO;;eAEFC,IAAjBR,KAAKS,QACH,GACiB,IAAjBT,KAAKS,QACLL,CAAI;;;wBAGQM,EACNV,KAAKK,cACLL,KAAKC;;;;;;0BAOGU;;;;cAKdP,CAAI;;;;;yBAKSJ,KAAKY;;;;0BAIJC;;;;;KAMvB,CAEON,mBAAmBO,GAGzB,GAFAd,KAAKS,QAAUK,EAAGC,OAEA,IAAdD,EAAGC,OACL,OAGF,MAAMC,EAAOC,SAASC,cAAc,KACpCF,EAAKG,SAAWnB,KAAKK,cAAgB,OACrCW,EAAKI,IAAM,WACXJ,EAAKK,KAAOX,EACVV,KAAKK,cACLL,KAAKC,yBAEPgB,SAASK,KAAKC,YAAYP,GACrBhB,KAAKE,YACRc,EAAKQ,QACLR,EAAKS,SAER,CAEOb,eACNc,EAAkB1B,KAAKK,cAAeL,KAAKC,wBAC5C,CAEOK,eACNN,KAAK2B,WAAYC,YAAY5B,KAC9B,GAEMH,EAAAgC,OAAS,CACdC,EACAC,CAAG;;;;OAlFcC,EAAA,CAAlBC,KAAyCpC,EAAAqC,UAAA,qBAAA,GACvBF,EAAA,CAAlBC,KAAiDpC,EAAAqC,UAAA,+BAAA,GAC/BF,EAAA,CAAlBC,KAAqCpC,EAAAqC,UAAA,iBAAA,GACrBF,EAAA,CAAhBG,KAAiCtC,EAAAqC,UAAA,eAAA,GAJ9BrC,EAAoBmC,EAAA,CADzBI,EAAc,2BACTvC"}